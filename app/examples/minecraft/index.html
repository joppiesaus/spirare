<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Block-Script</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
		<link rel="stylesheet" href="css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="css/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="style.css">
		
		<script src="https://code.jquery.com/jquery-2.1.3.min.js" defer></script>
		<script src="js/lib/three.min.js" defer></script>
		<script src="js/lib/knockout.js" defer></script>
		<script src="js/lib/knockout-mapping.js" defer></script>
		<script src="js/lib/underscore-min.js" defer></script>
		<script src="js/lib/minivents.js" defer></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js" defer></script>
		<script src="https://code.createjs.com/soundjs-0.6.0.min.js" defer></script>
		
		<script src="js/lib/threejs/controls/PointerLockControls.js" defer></script>
		<script src="js/lib/threejs/ImprovedNoise.js" defer></script>
		<script src="js/lib/threejs/Detector.js" defer></script>
		<script src="js/lib/threejs/libs/stats.min.js" defer></script>
		<script src="js/lib/threejs/loaders/ColladaLoader.js" defer></script>

		<script src="js/lib/functions.js" defer></script>
		<script src="js/lib/dexie.min.js" defer></script>
		<script src="js/util.js" defer></script>

		<!-- custom lib -->
		<script src="js/collision.js" defer></script>
		<script src="js/player.js" defer></script>
		<script src="js/map.js" defer></script>
		<script src="js/chunk.js" defer></script>
		
		<!-- states -->
		<script src="js/states.js" defer></script>
		<script src="js/states/menu.js" defer></script>
		<script src="js/states/game.js" defer></script>
		
		<!-- blocks -->
		<script src="js/blocks.js" defer></script>
		<script src="js/baseBlocks.js" defer></script>
		<script src="js/defineBlocks.js" defer></script>

		<!-- map -->
		<script src="js/mapLoader.js" defer></script>
		<script src="js/chunkGenerator.js" defer></script>

		<script src="js/sound.js" defer></script>
		<script src="js/main.js" defer></script>
		<script>
		  	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		  	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	
		  	ga('create', 'UA-62048613-1', 'auto');
		  	ga('send', 'pageview');
		</script>
	</head>
	<body>
		<div id="states">
			<div id="menu">
				<!-- main -->
				<div class="menu" data-bind="visible: menu() == 'main'">
					<div class="col-xs-12">
						<h1 style="text-align: center;">
							<div class="cube">
							    <div class="_3dbox">
							      	<div class="_3dface front"></div>
							      	<div class="_3dface top"></div>
							      	<div class="_3dface bottom"></div>
							      	<div class="_3dface left"></div>
							      	<div class="_3dface right"></div>
							      	<div class="_3dface back"></div>
							    </div>
							</div>
							Block-Script
						</h1>
					</div>
					<div class="col-xs-4 col-xs-offset-4">
						<button type="button" class="btn btn-lg btn-block btn-success" data-bind="click: $root.combind($root.set($root.menu,'maps'),$root.maps.loadMaps)"><i class="fa fa-gamepad"></i> Play</button>
						<button type="button" class="btn btn-lg btn-block btn-success" data-bind="click: $root.set($root.menu,'settings')"><i class="fa fa-cogs"></i> Settings</button>
					</div>
				</div>
				<!-- maps -->
				<div class="menu maps" data-bind="with: maps, visible: menu() == 'maps'">
					<div class="col-xs-12">
						<h1 style="text-align: center;"><i class="fa fa-picture-o"></i> Maps</h1>
						<div class="btn-group btn-group-sm pull-right" role="group">
						  	<button type="button" class="btn btn-default" data-toggle="modal" data-target="#new-map-modal"><i class="fa fa-plus"></i> New Map</button>
						  	<button type="button" class="btn btn-success" data-bind="attr: {'disabled': maps()[selected()] == undefined}, click: playMap"><i class="fa fa-gamepad"></i> Play</button>
						  	<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#delete-map-modal" data-bind="attr: {'disabled': maps()[selected()] == undefined}"><i class="fa fa-trash-o"></i> Delete</button>
						  	<div class="btn-group btn-group-sm" role="group">
							    <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
							    <ul class="dropdown-menu" role="menu">
							      	<li data-bind="css: {'disabled': maps()[selected()] == undefined}"><a href="#" data-bind="click: editMap"><i class="fa fa-pencil"></i> Edit</a></li>
							      	<li data-bind="css: {'disabled': maps()[selected()] == undefined}"><a href="#" data-bind="click: downloadMap"><i class="fa fa-download"></i> Download</a></li>
							      	<li><a href="#" data-bind="click: uploadMap"><i class="fa fa-upload"></i> Upload</a></li>
							    </ul>
						  	</div>
						</div>
					</div>
					<div class="col-xs-12">
						<div class="panel panel-default">
						  	<div class="panel-body">
								<div class="list-group" data-bind="foreach: maps">
								  	<a href="#" class="list-group-item" data-bind="click: $root.set($parent.selected,$index()), event: {dblclick: $root.set($parent.playMap,$index())}, css: {'active': $index() == $parent.selected()}">
								  		<span class="pull-right" data-bind="text: 'Created on: ' + createDate.toLocaleDateString()"></span>
								    	<h4 class="list-group-item-heading" data-bind="text: name"></h4>
								    	<p class="list-group-item-text" data-bind="text: desc"></p>
								  	</a>
								</div>
						  	</div>
						</div>
					</div>
					<div class="col-xs-4 col-xs-offset-4">
						<button type="button" class="btn btn-lg btn-block btn-success" data-bind="click: $root.set($root.menu,'main')"><i class="fa fa-arrow-left"></i> Back</button>
					</div>
				</div>
				<!-- settings -->
				<div class="menu" data-bind="with: settings, visible: menu() == 'settings'">
					<div class="col-xs-12">
						<h1 style="text-align: center;"><i class="fa fa-cogs"></i> Settings</h1>
					</div>
					<div class="col-xs-12">
						<div role="tabpanel">
						  	<!-- Nav tabs -->
						  	<ul class="nav nav-tabs" role="tablist">
						  	  	<li role="presentation"><a href="#genral" role="tab" data-toggle="tab"><i class="fa fa-wrench"></i> Genral</a></li>
						  	  	<li role="presentation"><a href="#graphics" role="tab" data-toggle="tab"><i class="fa fa-cubes"></i> Graphics</a></li>
						  	  	<li role="presentation"><a href="#sound" role="tab" data-toggle="tab"><i class="fa fa-volume-up"></i> Sound</a></li>
						  	</ul>
		
						  	<!-- Tab panes -->
						  	<div class="tab-content">
						  	  	<div role="tabpanel" class="tab-pane active" id="genral"></div>
						  	  	<div role="tabpanel" class="tab-pane" id="graphics" data-bind="with: graphics">
						  	  		<div class="row">
							  	  		<div class="col-xs-4">
								  	  		<div class="form-group">
											 	<label class="control-label">View Range</label>
											 	<input type="number" class="form-control" data-bind="value: viewRange, attr: {min: viewRangeRange()[0], max: viewRangeRange()[1]}">
											</div>
							  	  		</div>
							  	  		<div class="col-xs-4">
							  	  		</div>
							  	  		<div class="col-xs-4">
							  	  		</div>
						  	  		</div>
						  	  	</div>
						  	  	<div role="tabpanel" class="tab-pane" id="sound"></div>
						  	</div>
						</div>
					</div>
					<div class="col-xs-4 col-xs-offset-4">
						<button type="button" class="btn btn-lg btn-block btn-success" data-bind="click: $root.set($root.menu,'main')">Back <i class="fa fa-arrow-right"></i></button>
					</div>
				</div>

				<!-- new map -->
				<div class="modal fade" id="new-map-modal" tabindex="-1" role="dialog" data-bind="with: maps">
				  	<div class="modal-dialog">
				    	<div class="modal-content">
				      		<div class="modal-header">
				        		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				        		<h4 class="modal-title" id="myModalLabel">New Map</h4>
				      		</div>
					      	<div class="modal-body" data-bind="with: create">
					        	<form class="no-action" data-bind="event: {'submit': submit}">
								  	<div class="form-group">
								    	<label>Map Name</label>
								    	<input type="text" class="form-control" data-bind="value: name" required>
								  	</div>
								  	<div class="form-group">
								    	<label>Description</label>
								    	<textarea class="form-control" data-bind="value: desc"></textarea>
								  	</div>
						        	<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
						        	<button type="submit" class="btn btn-success pull-right">Create</button>
								</form>
					      	</div>
				    	</div>
				  	</div>
				</div>

				<!-- delete map -->
				<div class="modal fade" id="delete-map-modal" tabindex="-1" role="dialog" data-bind="with: maps">
				  	<div class="modal-dialog">
				    	<div class="modal-content">
				      		<div class="modal-header">
				        		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				        		<h4 class="modal-title" id="myModalLabel">Delete Map</h4>
				      		</div>
					      	<div class="modal-body">
					        	<h4>Are you sure you want to delete this map</h4>
					      	</div>
					      	<div class="modal-footer">
					      		<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
					      		<button type="button" class="btn btn-danger" data-bind="click: deleteMap">Delete</button>
					      	</div>
				    	</div>
				  	</div>
				</div>

				<!-- edit map -->
				<div class="modal fade" id="edit-map-modal" tabindex="-1" role="dialog" data-bind="with: maps">
				  	<div class="modal-dialog">
				    	<div class="modal-content">
				      		<div class="modal-header">
				        		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				        		<h4 class="modal-title" id="myModalLabel">Edit Map</h4>
				      		</div>
					      	<div class="modal-body" data-bind="with: edit">
					        	<form class="no-action" data-bind="event: {'submit': submit}">
								  	<div class="form-group">
								    	<label>Map Name</label>
								    	<input type="text" class="form-control" data-bind="value: name" required>
								  	</div>
								  	<div class="form-group">
								    	<label>Description</label>
								    	<textarea class="form-control" data-bind="value: desc"></textarea>
								  	</div>
						        	<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
						        	<button type="submit" class="btn btn-success pull-right">Save</button>
								</form>
					      	</div>
				    	</div>
				  	</div>
				</div>

				<!-- download map -->
				<div class="modal fade" id="download-map-modal" tabindex="-1" role="dialog" data-backdrop="static" data-bind="with: maps.download">
				  	<div class="modal-dialog">
				    	<div class="modal-content">
				      		<div class="modal-header">
				        		<h4 class="modal-title" id="myModalLabel">Download Map</h4>
				      		</div>
					      	<div class="modal-body">
					      		<div class="progress" data-bind="visible: progress() !== 100">
								  	<div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" data-bind="style: {'width': progress() + '%'}">
								    	<span class="sr-only"></span>
								  	</div>
								</div>
								<a class="btn btn-lg btn-default btn-block" data-bind="visible: progress() == 100, attr: {'href': (downloadLink() !== '')? downloadLink() : '#', 'download': downloadName() + '.map', 'disabled': (downloadLink() !== '')? false : true}">Download</a>
					      	</div>
					      	<div class="modal-footer">
					      		<button type="button" class="btn btn-primary" data-dismiss="modal" data-bind="visible: progress() == 100">Close</button>
					      	</div>
				    	</div>
				  	</div>
				</div>

				<!-- upload map -->
				<div class="modal fade" id="upload-map-modal" tabindex="-1" role="dialog" data-backdrop="static" data-bind="with: maps.upload">
				  	<div class="modal-dialog">
				    	<div class="modal-content">
				      		<div class="modal-header">
				        		<h4 class="modal-title" id="myModalLabel">Upload Map</h4>
				      		</div>
					      	<div class="modal-body">
					      		<div class="row" data-bind="visible: progress() == 0">
						      		<div class="col-xs-12">
							      		<!-- <div class="col-xs-12 drop-zone" data-bind="event: {drop: upload}">
							      			<p>Drag Map here</p>
							      			<small>only .map files work</small>
							      		</div> -->
							      		<div class="col-xs-4 col-xs-offset-2">
							      			<input type="file" class="btn btn-success" accept=".map" data-bind="event: {change: upload}">
						      			</div>
						      		</div>
					      		</div>
					      		<div class="row" data-bind="visible: progress() !== 0">
						      		<div class="col-xs-12">
							      		<div class="progress">
										 	<div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
										 	  	<span class="sr-only"></span>
										 	</div>
										</div>
						      		</div>
					      		</div>
					      	</div>
					      	<div class="modal-footer">
					      		<button type="button" class="btn btn-primary" data-dismiss="modal" data-bind="attr: { disabled: progress() !== 0 }">Done</button>
					      	</div>
				    	</div>
				  	</div>
				</div>
			</div>
			<div id="game">
				<div class="menus">
					<div class="esc" data-bind="visible: menu() == 'esc', with: esc">
						<div class="col-xs-4 col-xs-offset-4">
							<button type="button" class="btn btn-lg btn-default btn-block" data-bind="click: back"><i class="fa fa-chevron-left"></i> Back To Game <i class="fa fa-chevron-right"></i></button>
							<button type="button" class="btn btn-lg btn-default btn-block" data-bind="click: fullscreen"><i class="fa fa-desktop"></i> FullScreen</button>
							<button type="button" class="btn btn-lg btn-default btn-block" data-bind="click: menu"><i class="fa fa-bars"></i> Menu</button>
						</div>
					</div>
					<div class="invt panel panel-default" data-bind="with: blocks, visible: menu() == 'invt'">
  						<div class="panel-heading">Inventory</div>
						<div class="panel-body" data-bind="foreach: blocks">
							<!-- ko if: type == 'block' -->
							<div class="cube" data-bind="click: $root.set($parent.selectedBlock, name ), css: {'selected': name == $parent.selectedBlock() }">
							    <div class="_3dbox">
							      	<div class="_3dface front" data-bind="style: {'background': 'url('+ material[0][0] +')', 'background-size': '100%' }"></div>
							      	<div class="_3dface back" data-bind="style: {'background': 'url('+ material[0][1] +')', 'background-size': '100%' }"></div>
							      	<div class="_3dface top" data-bind="style: {'background': 'url('+ material[1][0] +')', 'background-size': '100%' }"></div>
							      	<div class="_3dface bottom" data-bind="style: {'background': 'url('+ material[1][1] +')', 'background-size': '100%' }"></div>
							      	<div class="_3dface right" data-bind="style: {'background': 'url('+ material[2][0] +')', 'background-size': '100%' }"></div>
							      	<div class="_3dface left" data-bind="style: {'background': 'url('+ material[2][1] +')', 'background-size': '100%' }"></div>
							    </div>
							</div>
							<!-- /ko -->
							<!-- ko if: type == 'flat' -->
							<div class="cube" data-bind="click: $root.set($parent.selectedBlock, name ), css: {'selected': name == $parent.selectedBlock() }">
								<img style="width: 100%;" data-bind="attr: {'src': material}">
							</div>
							<!-- /ko -->
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
